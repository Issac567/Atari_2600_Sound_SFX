<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="icon" href="data:,"> <!-- Remove annoying no fav icon -->
        <meta charset="UTF-8">
        <title>Atari 2600 SFX Editor</title>
        <style>
            /*================================================================================*/
            /* General body and header styles */
            /*================================================================================*/
            body { background-color: #1e1e1e; color: #f0f0f0; font-family: Arial, sans-serif; margin:0; padding:0; }
            h1 { text-align: center; margin: 20px 0; }

            /*================================================================================*/
            /* Styles for panel container, individual panels and headers */
            /*================================================================================*/
            .cls_panelContainer { display: flex; justify-content: center; gap: 10px; flex-wrap: nowrap; margin-top:10px;  }
            .cls_panel { border: 1px solid #555; padding: 15px; background-color: #2b2b2b; border-radius: 5px; }
            .cls_panel h3 { margin-top:0; margin-bottom:15px; text-align:center; }
            
            /*================================================================================*/
            /* KEYBOARD: Styles for Keyboard Panel layout */
            /*================================================================================*/
            #id_keyboardPanel.cls_panel { width: 95%; height: 160px; margin: 10px auto 10px auto; padding: 10px; user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; }

            /* Keyboard title */
            #id_keyboardPanel h3 { user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; }

            /* Keyboard keys container */
            #id_keyboardKeys { display: flex; justify-content: flex-start; gap: 2px; flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; padding-left: 2px; padding-right: 2px; }

            /* Optional: style scrollbar */
            #id_keyboardKeys::-webkit-scrollbar { height: 8px; }
            #id_keyboardKeys::-webkit-scrollbar-thumb { background: #aaa; border-radius: 3px; }

            /* Individual keys */
            #id_keyboardKeys button { flex: 1 1 0; min-width: 30px; height: 60px; margin: 2px 1px; border: 1px solid #555; border-radius: 4px; background: #eee; color: #111; font-weight: bold; cursor: pointer; user-select: none; text-align: center; transition: background 0.1s, transform 0.05s; }

            /* Key press / hover feedback */
            #id_keyboardKeys button:hover { background: #716767; }
            #id_keyboardKeys button:active { background: #CCC; transform: scale(0.95); }

            /* Responsive adjustments */
            @media (max-width: 800px) { #id_keyboardKeys button { height: 50px; font-size: 0.9rem; } }
            @media (max-width: 500px) { #id_keyboardKeys button { height: 40px; font-size: 0.8rem; } }

            /* Keyboard Export/Import Layout Buttons */
            #id_keyboardFileButtons { display: flex; justify-content: center; gap: 16px; width: 100%; padding: 8px 0; margin-top: 10px; border-top: none; align-items: center; }

            /* Styles for "Import/Export Buttons"  */
            #id_keyboardFileButtons .cls_KeyboardSaveLoadBtn { background-color:#757575; color:white; border:1px solid #555; border-radius:4px; cursor:pointer; padding:6px 14px; cursor: pointer; text-align: center; transition: background 0.2s; width:140px; }
            #id_keyboardFileButtons .cls_KeyboardSaveLoadBtn:hover { background-color: #616161; }

            /* Stlyes for "Add Played Tones" and Silence Gap checkbox */
            #id_keyboardFileButtons .cls_KeyboardCheckbox{ width: 160px; display: flex; }
            
            /*================================================================================*/
            /* STEP PARAMETERS: Styles for Step Parameters Panel layout */
            /*================================================================================*/
            #id_stepPanel.cls_panel { width: 430px; height: 220px;}

            /* Styles for labels, textboxes and Dropdown */
            #id_stepPanel .cls_inputRow { display:flex; align-items:center; margin-bottom:10px; }
            #id_stepPanel .cls_inputRow label { width: 220px; text-align:right; margin-right:10px; }
            #id_stepPanel .cls_inputRow input[type="number"], #id_stepPanel .cls_inputRow select { background-color:#333; color:#f0f0f0; border:1px solid #555; border-radius:3px; padding:5px 5px; text-align:center; width:179px; max-width:179px; }
            #id_stepPanel .cls_inputRow input:hover { border-color: #888;}
            #id_stepPanel .cls_inputRow select {text-align:left; padding:6px 5px; width: 190px; max-width:190px;}
            #id_stepPanel .cls_inputRow select:hover { border-color: #888;}

            /* Styles for "Add Steps at End" Button */
            #id_stepPanel .cls_AddStepsEnd { background-color:#2196F3; color:white; border:1px solid #555; border-radius:3px; cursor:pointer; padding:8px 5px; width:190px; max-width:190px; }
            #id_stepPanel .cls_AddStepsEnd:hover { background-color:#1568B0; }

            /*================================================================================*/
            /* PLAYBACK: Styles for Playback Management Panel layout */
            /*================================================================================*/
            #id_playbackPanel.cls_panel { width: 200px; height: 220px; display:flex; flex-direction: column; align-items:center; gap:15px }

            /* Styles for "Play All" Button */
            #id_playbackPanel .cls_playAllSequence { background-color: #4CAF50; color:white; border:none; cursor:pointer; border-radius:3px; padding:8px; width:180px; }
            #id_playbackPanel .cls_playAllSequence:hover { background-color: #29832C; }

            /* Styles for "Stop" Button */
            #id_playbackPanel .cls_StopAudio { background-color:#757575; color:white; border:1px solid #555; border-radius:3px; cursor:pointer; padding:8px; width:180px; text-align:center; }
            #id_playbackPanel .cls_StopAudio:hover { background-color:#616161; }

            /* Stlyes for "Loop Playback" and "PlayonChange" checkbox */
            #id_playbackPanel .cls_PlaybackCheckbox { width: 160px; display: flex; justify-content: left; }
 
            /*================================================================================*/
            /* TABLE MANAGEMENT: Styles for Table Management Panel layout */
            /*================================================================================*/
            #id_tableManagementPanel.cls_panel { width: 200px; height: 220px; display:flex; flex-direction: column; align-items:center; gap:15px }

            /* Styles for All 3 Buttons */
            #id_tableManagementPanel .cls_ManagementBtn { background-color:#757575; color:white; border:1px solid #555; border-radius:3px; cursor:pointer; padding:8px; width:180px; }
            #id_tableManagementPanel .cls_ManagementBtn:hover { background-color:#616161; }

            /*================================================================================*/
            /* UNDO/REDO: Styles for Undo/Redo Panel layout */
            /*================================================================================*/
            #id_undoRedoPanel.cls_panel { width: 200px; height: 220px; display:flex; flex-direction: column; align-items:center; gap:15px }

            /* Styles for All 3 Buttons */
            #id_undoRedoPanel .cls_UndoRedoBtn { background-color:#757575; color:white; border:1px solid #555; border-radius:3px; cursor:pointer; padding:8px; width:180px; }
            #id_undoRedoPanel .cls_UndoRedoBtn:hover { background-color:#616161; }

            /*================================================================================*/
            /* TABLE: Styles for table layout */
            /*================================================================================*/
            /* Style for Table Header title */
            #id_tonesTableTitle { display: flex; justify-content: center; align-items: center; font-size: 18px; font-weight: bold; color: white; margin-bottom: 20px; }           
            
            /* Style for Table, Table Header and Table Data */
            table { border-collapse:collapse; margin:10px auto; width:97%; background-color:#2b2b2b; }
            #id_tonesTable th, #id_tonesTable td { border:1px solid #555; padding:6px 10px; text-align:center; }
            #id_tonesTable th { background-color:#3a3a3a; }

            /* Styles for Dropdown and Textboxes */
            #id_tonesTable select, #id_tonesTable input[type="number"] { background-color:#333; color:#f0f0f0; border:1px solid #555; border-radius:3px; padding:5px; text-align:center; }
            #id_tonesTable select { width:190px; padding:6px; text-align:left;}
            #id_tonesTable select:hover { border-color: #888;}
            #id_tonesTable input[type="number"] { width:80px; }
            #id_tonesTable input:hover { border-color: #888;}

            /* Styles for the "Play" Button  */
            #id_tonesTable .cls_playBtn { background-color: #4CAF50; color:white; border:none; cursor:pointer; border-radius:3px; padding:8px; width:110px; }
            #id_tonesTable .cls_playBtn:hover { background-color:#29832C; }

            /* Styles for the "Delete" Button  */
            #id_tonesTable .cls_deleteBtn { background-color:#F44336; color:white; border:none; cursor:pointer; border-radius:3px; padding:8px; width: 50px; }
            #id_tonesTable .cls_deleteBtn:hover { background-color:#9F1919; }

            /* Styles for "Duplicate"  */
            #id_tonesTable .cls_insertBtn { background-color:#2196F3; color:white; border:1px solid #555; border-radius:3px; cursor:pointer; padding:8px; width:110px; }
            #id_tonesTable .cls_insertBtn:hover { background-color:#1568B0; }

            /* DRAG OVER: Style for Table Row being dragged over */
            #id_tonesTable tr.drag-over { border:2px dashed #ffcc00; }

            /*================================================================================*/
            /* FREQ/CTRL/VOL BYTE LABEL: Styles for Freq/Ctrl/Vol Panel layout */
            /*================================================================================*/
            #id_byteTablePanel.cls_panel { width: 95%; }

             /* Styles for both Labels */
            #id_byteTablePanel .cls_byteTableLabel{ margin-top:20px; text-align:center; color:#ffcc00; }

            /*================================================================================*/
            /* COPY TABLE: Styles for Copy Management Panel layout */
            /*================================================================================*/
            #id_copyTablesPanel.cls_panel { width:200px; height: 170px; text-align:center; display:flex; flex-direction:column; gap:15px; align-items:center; }

            /* Styles for All 2 buttons  */
            #id_copyTablesPanel .cls_CopyMangBnt { background-color:#757575; color:white; border:1px solid #555; border-radius:3px; cursor:pointer; padding:8px; width:180px; }
            #id_copyTablesPanel .cls_CopyMangBnt:hover { background-color:#616161; }

            /*================================================================================*/
            /* TOAST: Styles for toast notifications */
            /*================================================================================*/
            /* Styles for toast message */
            #id_toast { visibility:hidden; min-width:200px; background-color:#333; color:#fff; text-align:center; border-radius:4px; padding:10px; position:fixed; z-index:100; left:50%; bottom:30px; transform:translateX(-50%); font-size:16px; }
            #id_toast.show { visibility:visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }

            /* Fade-in animation for toast */
            @keyframes fadein { from {bottom:0; opacity:0;} to {bottom:30px; opacity:1;} }

            /* Fade-out animation for toast */
            @keyframes fadeout { from {bottom:30px; opacity:1;} to {bottom:0; opacity:0;} }

            /*================================================================================*/
            /* PAYPAL: Styles for Pay Pal Panel layout */
            /*================================================================================*/
            #id_paypalDonatePanel.cls_panel { text-align: center; }

            /* Styles for PayPal button */
            #id_paypalDonatePanel .cls_paypalButton { display: inline-block; background-color: #0070BA; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold; transition: background-color 0.2s; }
            #id_paypalDonatePanel .cls_paypalButton:hover { background-color: #005C99; /* Darker blue on hover */ }

            /*================================================================================*/
            /* VERSION LABEL: Style for version label at the bottom of the editor */
            /*================================================================================*/
            #id_versionLabel { text-align: center; color: #888; font-size: 14px; font-style: italic; margin-top: 20px; margin-bottom: 20px;}

        </style>                    
    </head>
    <body>
        <!-- This is a header -->
        <h1>Atari 2600 SFX Editor with TIA Sound Generator</h1>

        <!-- ======================================= -->
        <!-- This is a Keyboard -->
        <!-- ======================================= -->
        <div class="cls_panel" id="id_keyboardPanel">
            <!-- This is a header -->
            <h3>Keyboard (Hold Down Play + Draggable)</h3>

            <div id="id_keyboardKeys"></div>

            <!-- Save / Load buttons INSIDE keyboard panel -->
            <div id="id_keyboardFileButtons">
                <!-- This is a Save layout button -->
                <button id="id_SaveKeyboardLayout" class="cls_KeyboardSaveLoadBtn" onclick="btnSaveKeyboardLayout()">Save Layout</button>
            
                <!-- This is a Load layout button triggers triggerLoadKeyboardLayout -->
                <button id="id_LoadKeyboardLayout" class="cls_KeyboardSaveLoadBtn" onclick="btnLoadKeyboardLayout()">Load Layout</button>
            
                <!-- File input for loading keyboard layout (JSON format) -->
                <input type="file" id="id_loadKeyboardLayoutFileInput" accept=".json" hidden onchange="triggerLoadKeyboardLayout(event)">

                <!-- This is a Add Played Tone Checkbox   -->
                <div class="cls_KeyboardCheckbox">
                    <label class="cls_customCheckbox">
                        <input type="checkbox" id="id_KeyboardAddPlayedTone" onclick="chkKeyboardAddPlayedTone(this.checked)">
                        <span class="cls_checkmark"></span>
                        Add Played Tone
                    </label>
                </div>

                <!-- This is a Silence Gap Checkbox   -->
                <div class="cls_KeyboardCheckbox">
                    <label class="cls_customCheckbox">
                        <input type="checkbox" id="id_KeyboardSilenceTone" onclick="chkKeyboardSilenceTone(this.checked)" disabled>
                        <span class="cls_checkmark"></span>
                        Add Silence Gap
                    </label>
                </div>
            </div>
        </div>

        <!-- ======================================= -->
        <!-- This is a Step Parameters Panel -->
        <!-- ======================================= -->
        <div class="cls_panelContainer">
            <div class="cls_panel" id="id_stepPanel">
                <!-- This is a header -->
                <h3>Step Parameters</h3>
        
                <!-- This is a Control Dropbox -->
                <div class="cls_inputRow">
                    <label for="id_ctl">Control:</label>
                    <select id="id_ctl">
                        <option value="1">1 = Buzzy</option><option value="2">2 = Distortion</option>
                        <option value="3">3 = Flangy</option><option value="4">4 = Pure</option>
                        <option value="5">5 = Pure</option><option value="6" selected>6 = Between Pure/Buzzy</option>
                        <option value="7">7 = Reedy</option><option value="8">8 = White Noise</option>
                        <option value="9">9 = Reedy</option><option value="10">10 = Between Pure/Buzzy</option>
                        <option value="11">11 = Silent-ish</option><option value="12">12 = Low Pure</option>
                        <option value="13">13 = Low Pure</option><option value="14">14 = Electronic Low</option>
                        <option value="15">15 = Electronic Low</option>
                    </select>
                </div>

                <!-- This is a Frequency Textbox -->
                <div class="cls_inputRow">
                    <label for="id_freq">Frequency (0=high, 31=low):</label>
                    <input id="id_freq" type="number" min="0" max="31" value="4">
                </div>

                <!-- This is a Volume Textbox -->
                <div class="cls_inputRow">
                    <label for="id_vol">Volume (0=off, 15=high):</label>
                    <input id="id_vol" type="number" min="0" max="15" value="10">
                </div>

                <!-- This is a Repeat Textbox -->
                <div class="cls_inputRow">
                    <label for="id_repeat">Repeat (1-100):</label>
                    <input id="id_repeat" type="number" min="1" max="100" value="1">
                </div>

                <!-- This is a Add Step at end Button -->
                <div class="cls_inputRow">
                    <label></label>
                    <button id="id_AddStepsEnd"
                            class="cls_AddStepsEnd"
                            onclick="btnAddStepEnd()">
                        Add Steps at End
                    </button>
                </div>
            </div>

            <!-- ======================================= -->
            <!-- This is a Playback Panel -->
            <!-- ======================================= -->
            <div class="cls_panel" id="id_playbackPanel">
                <!-- This is a header -->
                <h3>Playback</h3>
            
                <!-- This is a Play All Button -->
                <button id="id_playAllSequence" class="cls_playAllSequence" onclick="btnplayAllSequence()">Play All</button>

                <!-- This is a Stop Button -->
                <button id="id_StopAudio" class="cls_StopAudio" onclick="btnStopAudio()">Stop</button>

                <!-- This is a Loop Playback Checkbox  -->
                <div class="cls_PlaybackCheckbox">
                    <label class="cls_customCheckbox">
                    <input type="checkbox" id="id_LoopPlayback" onclick="chkLoopPlayback(this.checked)">
                    <span class="cls_checkmark"></span>
                    Loop Playback
                    </label>
                </div>

                <!-- This is a Play on change Checkbox  -->
                <div class="cls_PlaybackCheckbox">
                    <label class="cls_customCheckbox">
                    <input type="checkbox" id="id_PlayOnChange" checked>
                    <span class="cls_checkmark"></span>
                    Play on Change
                    </label>
                </div>         
            </div>

            <!-- ======================================= -->
            <!-- This is a Table Management Panel -->
            <!-- ======================================= -->
            <div class="cls_panel" id="id_tableManagementPanel">
                <!-- This is a header -->
                <h3>Table Management</h3>

                <!-- This is a New Table Button -->
                <button id="id_NewTable" class="cls_ManagementBtn" onclick="btnNewTable()">New Table</button>

                <!-- This is a New Save Button -->
                <button id="id_SaveTable" class="cls_ManagementBtn" onclick="btnSaveTable()">Save Table</button>

                <!-- This is a Load Table Button Triggers the triggerLoadTable -->
                <button id="id_LoadTable" class="cls_ManagementBtn" onclick="btnLoadTable()">Load Table</button>

                <!-- File input for loading table layout (JSON format) -->
                <input type="file" id="id_loadTableFileInput" accept=".json" hidden onchange="triggerLoadTable(event)">
            </div>

            <!-- ======================================= -->
            <!-- This is a Undo/Redo Panel -->
            <!-- ======================================= -->
            <div class="cls_panel" id="id_undoRedoPanel">
                <!-- This is a header -->
                <h3>Undo/Redo</h3>

                <!-- This is a New Table Button -->
                <button id="id_Undo" class="cls_UndoRedoBtn" onclick="btnUndo()">Undo</button>

                <!-- This is a New Save Button -->
                <button id="id_SaveTable" class="cls_UndoRedoBtn" onclick="btnRedo()">Redo</button>
            </div>
        </div>

        <!-- ======================================= -->
        <!-- This is a Table and Header -->
        <!-- ======================================= -->
        <h3 id="id_tonesTableTitle">Table Name</h3>
        <table id="id_tonesTable">
            <thead>
                <tr>
                    <th>#</th><th>Control</th><th>Frequency</th><th>Volume</th>
                    <th>Repeat</th><th>Play</th><th>Delete</th><th>Duplicate</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        
        <!-- ======================================= -->
        <!-- This is a Freq/Crtl/Volume Label Panel -->
        <!-- ======================================= -->
        <div class="cls_panelContainer">
            <div class="cls_panel" id="id_byteTablePanel">
                <!-- This is a header -->
                <h3>Byte Tables</h3>

                <!-- This is a Freq Label -->
                <div id="id_frequencyTableLabel" class="cls_byteTableLabel">Frequency Table:</div>

                <!-- This is a Control/Vol Label -->
                <div id="id_controlVolumeTableLabel" class="cls_byteTableLabel">Control/Volume Table:</div>
            </div>
        </div>

        <!-- ======================================= -->
        <!-- This is a Copy Table Panel -->
        <!-- ======================================= -->
        <div class="cls_panelContainer">
            <div class="cls_panel" id="id_copyTablesPanel">
                <!-- This is a header -->
                <h3>Copy Byte Tables</h3>

                <!-- This is a Copy Freq Button -->
                <button id="id_CopyFrequency" class="cls_CopyMangBnt" onclick="btnCopyFrequency()">Copy Frequency Table</button>

                <!-- This is a Control/Vol Button -->
                <button id="id_CopyControlVolume" class="cls_CopyMangBnt" onclick="btnCopyControlVolume()">Copy Control/Volume Table</button>
            </div>
        </div>

        <!-- ======================================= -->
        <!-- This is a toast -->
        <!-- ======================================= -->
        <div id="id_toast"></div>

        <!-- ======================================= -->
        <!-- This is a Paypal Donation  -->
        <!-- ======================================= -->
        <div class="cls_panelContainer">
            <!-- PayPal Donate Panel -->
            <div class="cls_panel" id="id_paypalDonatePanel">
                <h3>Support Atari 2600 SFX Editor</h3>
                <p>Every little bit helps keep this project alive!</p>
                <a href="https://www.paypal.com/donate/?business=TXDQNPWL3YQPE&no_recurring=1&item_name=Support+my+work+%E2%80%94+every+little+bit+helps&currency_code=USD" target="_blank" class="cls_paypalButton">
                    Donate with PayPal
                </a>
            </div>
        </div>

        <!-- ======================================= -->
        <!-- This is a Version label -->
        <!-- ======================================= -->
        <div id="id_versionLabel">Version 3.01</div>

        <script src="JavaScript/wasm_exec.js"></script>

        <script src="JavaScript/public.js"></script>
        <script src="JavaScript/keyboard.js"></script>
        <script src="JavaScript/stepPanel.js"></script>
        <script src="JavaScript/playback.js"></script>
        <script src="JavaScript/undoRedo.js"></script>
        <script src="JavaScript/tableManagement.js"></script>
        <script src="JavaScript/table.js"></script>
        <script src="JavaScript/copyTables.js"></script>
        <script src="JavaScript/init.js"></script> 

        <script> 
            const go=new Go();
            WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then(result => { go.run(result.instance); });
        </script>

    </body>
</html>


